<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ben the Ninja</title>
    
</head>
<body>
    <canvas id="gameCanvas" width="600" height="800"></canvas>
    <script>var canvas;
        var canvasContext;
        var ninjaX = 20;
        var ninjaY = 640-80;
        var ninjaXSpeed = 7;
        var ninjaYSpeed = 14;
        var ninjaSizeX = 40;
        var ninjaSizeY = 75;
        var tileWidth = 75;
        var tileHeight = 80;
        var angle = 0;
        var Ninja_idleLoaded = false;
        let ninjaInAir = false;
        let ninjaJump = 0;
        let ninjaRunning = false;
        let ninjaRunningTime = 0;
        
        var mushroomSizeX = 40;
        var mushroomSizeY = 40;
        var mushroomList = [];
        var mushroomTimer = 0;
        var mushroomObject = {
            width: 40,
            height: 40,
            speed: 4,
        }
        
        mapGrid = [0, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0,
                0, 3, 4, 0, 0, 3, 4, 0,
                0, 0, 0, 0, 0, 0, 0, 0,
                1, 1, 1, 1, 1, 1, 1, 1,
                2, 2, 2, 2, 2, 2, 2, 2,]
        
        window.onload = function(){
            canvas = document.getElementById("gameCanvas")
            canvasContext = canvas.getContext('2d');
            
            document.addEventListener('keydown', keyPressed);
            document.addEventListener('keyup', keyReleased);
        
            colorRect(0, 0, canvas.width, canvas.height, 'black')
            loadImages();
            
            startGame();
        }
        
        function update(){
            colorRect(0, 0, canvas.width, canvas.height, 'black')
            
            drawAll();
            ninjaCollision();
            mushroomCollision();
            ninjaMove();
            jump();
        }
        
        function startGame(){
            var framesPerSecond = 30;
            setInterval(update,1000/framesPerSecond)
        }
        
        function ninjaMove() {
            if(RUNNING_LEFT && ninjaPermissionToMove){
                ninjaX -= ninjaXSpeed;
            }
            if(RUNNING_RIGHT && ninjaPermissionToMove){
                ninjaX += ninjaXSpeed;
            }
            if(RUNNING_UP && ninjaPermissionToMove && !ninjaInAir){ //Add ninja has to be on ground to jump
                ninjaInAir = true;
                ninjaJump = 150;
            }
            if(ninjaRunning && !ninjaInAir){
                ninjaRunningTime = (ninjaRunningTime + 1) % 10
            }
            
            
            // if(RUNNING_DOWN && ninjaPermissionToMove){
            // 	ninjaY += ninjaYSpeed;
            // }
        }
        
        function jump() {
            if(ninjaInAir && ninjaJump > 0){
                ninjaY -= ninjaYSpeed;
                ninjaJump -= ninjaYSpeed;
            }
            if(ninjaInAir && ninjaJump <= 0 && ninjaJump > -150){
                ninjaY += ninjaYSpeed;
                ninjaJump -= ninjaYSpeed
            }
            if(ninjaInAir && ninjaJump <= -150){
                ninjaInAir = false;
            }
        }
        //COLLISION
        function ninjaCollision() {
            var ninjaInColumn = Math.floor(ninjaX/tileWidth); // this will always be 0-7 (8 will be outofbounds)
            var ninjaInRow = Math.floor((ninjaY+ninjaSizeY)/tileHeight); //this will always be 0-9 (10 will be outofbounds)
            var tileThatNinjaIsOn = ninjaInColumn + ninjaInRow * 8; //8 comes from 75 pixels 8 times in X col
        
            var tileIndexNinjaStandingOn = mapGrid[tileThatNinjaIsOn]
            if(tileIndexNinjaStandingOn == 1){
                    ninjaY = 640-75;
            }
            if(ninjaX < 10){
                ninjaX = 10;
            }
            if(ninjaX > canvas.width - ninjaSizeX){
                ninjaX = canvas.width - ninjaSizeX;
            }
        }
        function mushroomCollision() {
            //collision with a platform
            for(i=0; i<mushroomList.length;i++){
                var shroomInColumn = Math.floor((mushroomList[i].x)/tileWidth) //finding the tile x wise its in
                var shroomInRow = Math.floor((mushroomList[i].y+40)/tileHeight);
                var shroomInColumn2 = Math.floor((mushroomList[i].x+40)/tileWidth); //finding the tile x wise its in
                var shroomInRow2 = Math.floor((mushroomList[i].y+40)/tileHeight);
                var tileThatShroomXYisOn = shroomInColumn + shroomInRow * 8;
                var tileThatShroomXYisOn2 = shroomInColumn2 + shroomInRow2 * 8;
                if(mapGrid[tileThatShroomXYisOn] != 0 || mapGrid[tileThatShroomXYisOn2] != 0) {
                    mapGrid[tileThatShroomXYisOn] = 0;
                    mapGrid[tileThatShroomXYisOn2] = 0;
                }
                
            }
            //collision with ninja
            for(i=0; i<mushroomList.length; i++){
                if(ninjaX < (mushroomList[i].x+40) && mushroomList[i].x < ninjaX+40
                && ninjaY < mushroomList[i].y+40 && mushroomList[i].y < ninjaY+80) {
                    mushroomList.splice(i,1)
                }
            }
        } </script>
    <script> //INSTANTIATING IMAGES
        var Ninja_idle = document.createElement("img"); //need this for image files
        var Ninja_jump0 = document.createElement("img");
        var Ninja_jump1 = document.createElement("img");
        var Ninja_jump2 = document.createElement("img");
        var Ninja_jump3 = document.createElement("img");
        var Ninja_jump4 = document.createElement("img");
        var Ninja_jump5 = document.createElement("img");
        var Ninja_jump6 = document.createElement("img");
        var Ninja_jump7 = document.createElement("img");
        var Ninja_jump8 = document.createElement("img");
        var Ninja_jump9 = document.createElement("img");
        var Ninja_run0 = document.createElement("img");
        var Ninja_run1 = document.createElement("img");
        var Ninja_run2 = document.createElement("img");
        var Ninja_run3 = document.createElement("img");
        var Ninja_run4 = document.createElement("img");
        var Ninja_run5 = document.createElement("img");
        var Ninja_run6 = document.createElement("img");
        var Ninja_run7 = document.createElement("img");
        var Ninja_run8 = document.createElement("img");
        var Ninja_run9 = document.createElement("img");
        var tile1 = document.createElement("img");
        var tile2 = document.createElement("img");
        var tileSkyLeft = document.createElement("img");
        var tileSkyRight = document.createElement("img");
        var mushroom1 = document.createElement("img");
        
        
        
        //WE ARE LOADING IMAGES
        function loadImages() {
            Ninja_idle.src = "images/Ninja/Idle__000.png";
            Ninja_jump0.src = "images/Ninja/Jump__000.png";
            Ninja_jump1.src = "images/Ninja/Jump__001.png";
            Ninja_jump2.src = "images/Ninja/Jump__002.png";
            Ninja_jump3.src = "images/Ninja/Jump__003.png";
            Ninja_jump4.src = "images/Ninja/Jump__004.png";
            Ninja_jump5.src = "images/Ninja/Jump__005.png";
            Ninja_jump6.src = "images/Ninja/Jump__006.png";
            Ninja_jump7.src = "images/Ninja/Jump__007.png";
            Ninja_jump8.src = "images/Ninja/Jump__008.png";
            Ninja_jump9.src = "images/Ninja/Jump__009.png";
            Ninja_run0.src = "images/Ninja/Run__000.png";
            Ninja_run1.src = "images/Ninja/Run__001.png";
            Ninja_run2.src = "images/Ninja/Run__002.png";
            Ninja_run3.src = "images/Ninja/Run__003.png";
            Ninja_run4.src = "images/Ninja/Run__004.png";
            Ninja_run5.src = "images/Ninja/Run__005.png";
            Ninja_run6.src = "images/Ninja/Run__006.png";
            Ninja_run7.src = "images/Ninja/Run__007.png";
            Ninja_run8.src = "images/Ninja/Run__008.png";
            Ninja_run9.src = "images/Ninja/Run__009.png";
            tile1.src = "images/Tiles/2.png";
            tile2.src = "images/Tiles/5.png";
            tileSkyLeft.src = "images/Tiles/13.png";
            tileSkyRight.src = "images/Tiles/15.png";
            mushroom1.src = "images/Object/Mushroom_1.png"
        }
        
        function drawNinja(){
            //Ninja JUMP
            if(ninjaInAir && ninjaJump <= 150 && ninjaJump > 135){
                drawImageSprite(Ninja_jump0, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
            if(ninjaInAir && ninjaJump <= 135 && ninjaJump > 100){
                drawImageSprite(Ninja_jump1, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
            if(ninjaInAir && ninjaJump <= 100 && ninjaJump > 60){
                drawImageSprite(Ninja_jump2, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
            if(ninjaInAir && ninjaJump <= 60 && ninjaJump > 10){
                drawImageSprite(Ninja_jump3, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
            if(ninjaInAir && ninjaJump <= 10 && ninjaJump > -40){
                drawImageSprite(Ninja_jump4, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
            if(ninjaInAir && ninjaJump <= -40 && ninjaJump > -70){
                drawImageSprite(Ninja_jump5, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
            if(ninjaInAir && ninjaJump <= -70 && ninjaJump > -90){
                drawImageSprite(Ninja_jump6, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
            if(ninjaInAir && ninjaJump <= -90 && ninjaJump > -115){
                drawImageSprite(Ninja_jump7, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
            if(ninjaInAir && ninjaJump <= -115 && ninjaJump > -130){
                drawImageSprite(Ninja_jump8, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
            if(ninjaInAir && ninjaJump <= -130 && ninjaJump > -150){
                drawImageSprite(Ninja_jump9, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
            //NINJA RUN
            
            if(ninjaRunning && ninjaRunningTime == 0 && !ninjaInAir){
                drawImageSprite(Ninja_run0, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
            if(ninjaRunning && ninjaRunningTime == 1 && !ninjaInAir){
                drawImageSprite(Ninja_run1, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
            if(ninjaRunning && ninjaRunningTime == 2 && !ninjaInAir){
                drawImageSprite(Ninja_run2, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
            if(ninjaRunning && ninjaRunningTime == 3 && !ninjaInAir){
                drawImageSprite(Ninja_run3, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
            if(ninjaRunning && ninjaRunningTime == 4 && !ninjaInAir){
                drawImageSprite(Ninja_run4, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
            if(ninjaRunning && ninjaRunningTime == 5 && !ninjaInAir){
                drawImageSprite(Ninja_run5, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
            if(ninjaRunning && ninjaRunningTime == 6 && !ninjaInAir){
                drawImageSprite(Ninja_run6, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
            if(ninjaRunning && ninjaRunningTime == 7 && !ninjaInAir){
                drawImageSprite(Ninja_run7, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
            if(ninjaRunning && ninjaRunningTime == 8 && !ninjaInAir){
                drawImageSprite(Ninja_run8, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
            if(ninjaRunning && ninjaRunningTime == 9 && !ninjaInAir){
                drawImageSprite(Ninja_run9, ninjaX, ninjaY, ninjaSizeX+15, ninjaSizeY)
            }
                
            
            if(!ninjaInAir && !ninjaRunning) {
                drawImageSprite(Ninja_idle, ninjaX, ninjaY, ninjaSizeX, ninjaSizeY)
            }
            
        }
        function drawMushroom() {
            for(i=0;i<mushroomList.length;i++){
                drawImageSprite(mushroom1, mushroomList[i].x, mushroomList[i].y, mushroomObject.width, mushroomObject.height)
                if(mushroomList[i].y > 1600){
                    mushroomList.splice(i,1)
                }
                mushroomList[i].y += mushroomObject.speed;
                
                
            }
        }
        
        function mushroomCreation() {
            if(mushroomTimer % 100 == 0){
                mushroomList.push({x: Math.random()*550, y: 0})
            }
        }
        
        //TILE DRAWING AND CALCULATION
        // j + i * 8 to calculate which grid were talking about
        function drawTiles() {
            for(i=0; i<mapGrid.length; i++){
                for(j=0; j<8; j++){
                    if(mapGrid[j + i * 8] == 1){
                        drawImageSprite(tile1, 75*j, 80*i, tileWidth, tileHeight)
                    }
                    if(mapGrid[j + i * 8] == 2){
                        drawImageSprite(tile2, 75*j, 80*i, tileWidth, tileHeight)
                    }
                    if(mapGrid[j + i * 8] == 3){
                        drawImageSprite(tileSkyLeft, 75*j, 80*i, tileWidth, tileHeight)
                    }
                    if(mapGrid[j + i * 8] == 4){
                        drawImageSprite(tileSkyRight, 75*j, 80*i, tileWidth, tileHeight)
                    }
                }
            }
        }
        
        function drawAll() {
            drawTiles();
            mushroomCreation();
            drawMushroom();
            drawNinja();
            mushroomTimer++;
        }</script>
    <script>//WE ARE FUNCTIONS TO DRAW IMAGES BELOW
        function drawImageSprite(useImage, atX,atY, scaleX, scaleY) {
            canvasContext.save();
            canvasContext.drawImage(useImage, atX, atY, scaleX, scaleY);
            canvasContext.restore();
        }
        
        function colorRect(topLeftX,topLeftY, boxWidth,boxHeight, fillColor) {
            canvasContext.fillStyle = fillColor;
            canvasContext.fillRect(topLeftX,topLeftY, boxWidth,boxHeight);
        }
        
        function colorCircle(centerX,centerY, radius, fillColor) {
            canvasContext.fillStyle = fillColor;
            canvasContext.beginPath();
            canvasContext.arc(centerX,centerY, 10, 0,Math.PI*2, true);
            canvasContext.fill();
        }
        
        function colorText(showWords, textX,textY, fillColor) {
            canvasContext.fillStyle = fillColor;
            canvasContext.fillText(showWords, textX, textY);
        }</script>
    <script>const KEY_LEFT_ARROW = 37;
        const KEY_UP_ARROW = 38;
        const KEY_RIGHT_ARROW = 39;
        const KEY_DOWN_ARROW = 40;
        
        let RUNNING_RIGHT = false;
        let RUNNING_LEFT = false;
        let RUNNING_UP = false;
        let RUNNING_DOWN = false;
        let ninjaPermissionToMove = true;
        
        //KEYPRESSES
        function keyPressed(evt){
            if(evt.keyCode == KEY_LEFT_ARROW){
                RUNNING_LEFT = true;
                ninjaRunning = true;
                // ninjaRunningTime = (ninjaRunningTime + 1) % 10 //always give between 0-9
            }
            if(evt.keyCode == KEY_UP_ARROW){
                RUNNING_UP = true;
            }
            if(evt.keyCode == KEY_RIGHT_ARROW){
                RUNNING_RIGHT = true;
                ninjaRunning = true;
                // ninjaRunningTime = (ninjaRunningTime + 1) % 10 //always give between 0-9
                console.log(ninjaRunningTime, ninjaRunning)
            }
            // if(evt.keyCode == KEY_DOWN_ARROW){
            // 	RUNNING_DOWN = true;
            // }
            evt.preventDefault();
        }
        
        function keyReleased(evt) {
            if(evt.keyCode == KEY_LEFT_ARROW){
                RUNNING_LEFT = false;
                ninjaRunning = false;
                ninjaRunningTime = 10
                console.log(ninjaRunningTime, ninjaRunning)
            }
            if(evt.keyCode == KEY_UP_ARROW){
                RUNNING_UP = false;
            }
            if(evt.keyCode == KEY_RIGHT_ARROW){
                RUNNING_RIGHT = false;
                ninjaRunning = false;
                ninjaRunningTime = 10;
            }
            // if(evt.keyCode == KEY_DOWN_ARROW){
            // 	RUNNING_DOWN = false;
            // }
        }</script>
</body>
</html>